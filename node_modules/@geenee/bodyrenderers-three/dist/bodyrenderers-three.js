import{SceneRenderer as C,ScenePlugin as K,VideoPlugin as V}from'@geenee/armature';import*as q from'three';import{meshTriangles as N,meshUV as O,meshDesc as x}from'@geenee/bodytracking';var A=function(y0,y1){return A=Object['setPrototypeOf']||{'__proto__':[]}instanceof Array&&function(y2,y3){y2['__proto__']=y3;}||function(y2,y3){for(var y4 in y3)Object['prototype']['hasOwnProperty']['call'](y3,y4)&&(y2[y4]=y3[y4]);},A(y0,y1);};function W(y0,y1){if('function'!=typeof y1&&null!==y1)throw new TypeError('Class\x20extends\x20value\x20'+String(y1)+'\x20is\x20not\x20a\x20constructor\x20or\x20null');function y2(){this['constructor']=y0;}A(y0,y1),y0['prototype']=null===y1?Object['create'](y1):(y2['prototype']=y1['prototype'],new y2());}function H(y0,y1,y2,y3){return new(y2||(y2=Promise))(function(y4,y5){function y6(y9){try{y8(y3['next'](y9));}catch(yy){y5(yy);}}function y7(y9){try{y8(y3['throw'](y9));}catch(yy){y5(yy);}}function y8(y9){var yy;y9['done']?y4(y9['value']):(yy=y9['value'],yy instanceof y2?yy:new y2(function(yC){yC(yy);}))['then'](y6,y7);}y8((y3=y3['apply'](y0,y1||[]))['next']());});}function E(y0,y1){var y2,y3,y4,y5,y6={'label':0x0,'sent':function(){if(0x1&y4[0x0])throw y4[0x1];return y4[0x1];},'trys':[],'ops':[]};return y5={'next':y7(0x0),'throw':y7(0x1),'return':y7(0x2)},'function'==typeof Symbol&&(y5[Symbol['iterator']]=function(){return this;}),y5;function y7(y8){return function(y9){return function(yy){if(y2)throw new TypeError('Generator\x20is\x20already\x20executing.');for(;y6;)try{if(y2=0x1,y3&&(y4=0x2&yy[0x0]?y3['return']:yy[0x0]?y3['throw']||((y4=y3['return'])&&y4['call'](y3),0x0):y3['next'])&&!(y4=y4['call'](y3,yy[0x1]))['done'])return y4;switch(y3=0x0,y4&&(yy=[0x2&yy[0x0],y4['value']]),yy[0x0]){case 0x0:case 0x1:y4=yy;break;case 0x4:return y6['label']++,{'value':yy[0x1],'done':!0x1};case 0x5:y6['label']++,y3=yy[0x1],yy=[0x0];continue;case 0x7:yy=y6['ops']['pop'](),y6['trys']['pop']();continue;default:if(!(y4=y6['trys'],(y4=y4['length']>0x0&&y4[y4['length']-0x1])||0x6!==yy[0x0]&&0x2!==yy[0x0])){y6=0x0;continue;}if(0x3===yy[0x0]&&(!y4||yy[0x1]>y4[0x0]&&yy[0x1]<y4[0x3])){y6['label']=yy[0x1];break;}if(0x6===yy[0x0]&&y6['label']<y4[0x1]){y6['label']=y4[0x1],y4=yy;break;}if(y4&&y6['label']<y4[0x2]){y6['label']=y4[0x2],y6['ops']['push'](yy);break;}y4[0x2]&&y6['ops']['pop'](),y6['trys']['pop']();continue;}yy=y1['call'](y0,y6);}catch(yC){yy=[0x6,yC],y3=0x0;}finally{y2=y4=0x0;}if(0x5&yy[0x0])throw yy[0x1];return{'value':yy[0x0]?yy[0x1]:void 0x0,'done':!0x0};}([y8,y9]);};}}function F(y0,y1,y2){if(y2||0x2===arguments['length']){for(var y3,y4=0x0,y5=y1['length'];y4<y5;y4++)!y3&&y4 in y1||(y3||(y3=Array['prototype']['slice']['call'](y1,0x0,y4)),y3[y4]=y1[y4]);}return y0['concat'](y3||Array['prototype']['slice']['call'](y1));}var U=function(y0){function y1(y2,y3,y4){var y5=y0['call'](this,{'container':y2,'mode':y3,'layerCount':0x2,'mirror':y4})||this;y5['cameraAngle']=0xa/0xb4*Math['PI'];var y6=y5['canvas']['layers'][0x1];return y5['renderer']=new q['WebGLRenderer']({'canvas':y6,'alpha':!0x0,'preserveDrawingBuffer':!0x0}),y5['renderer']['setClearColor'](0x0,0x0),y5['renderer']['setPixelRatio'](window['devicePixelRatio']),y5['renderer']['setSize'](y6['clientWidth'],y6['clientHeight']),y5['renderer']['physicallyCorrectLights']=!0x0,y5['renderer']['outputEncoding']=q['sRGBEncoding'],y5['canvas']['on']('resize',function(){y5['renderer']['setSize'](y6['clientWidth'],y6['clientHeight']);}),y5['scene']=new q['Scene'](),y5['scene']['background']=null,y5['camera']=new q['PerspectiveCamera'](y5['cameraAngle'],0x1,0.02,0x14),y5;}return W(y1,y0),y1['prototype']['updateScene']=function(){this['scene']&&this['renderer']['render'](this['scene'],this['camera']);},y1['prototype']['setupCamera']=function(y2,y3){y0['prototype']['setupCamera']['call'](this,y2,y3),this['camera']instanceof q['PerspectiveCamera']&&(this['camera']['aspect']=this['cameraRatio'],this['camera']['fov']=this['cameraAngle']/Math['PI']*0xb4,this['camera']['updateProjectionMatrix']());},y1['prototype']['setupVideo']=function(y2,y3){y0['prototype']['setupVideo']['call'](this,y2,y3),this['camera']instanceof q['OrthographicCamera']&&(this['camera']['right']=this['videoSize']['width'],this['camera']['bottom']=this['videoSize']['height'],this['camera']['updateProjectionMatrix']());},y1['prototype']['disposeObject']=function(y2){y2['removeFromParent'](),y2['traverse'](function(y3){var y4,y5;y3 instanceof q['Mesh']&&(y3['geometry']instanceof q['BufferGeometry']&&y3['geometry']['dispose'](),y3['material']instanceof q['Material']&&y3['material']['dispose'](),y4=y3['material'],y5=q['Material'],Array['isArray'](y4)&&y4['every'](function(y6){return y6 instanceof y5;})&&y3['material']['forEach'](function(y6){for(var y7 in(y6['dispose'](),y6)){var y8=y6[y7];y8 instanceof q['Texture']&&y8['dispose']();}}));});},y1;}(C),Y=function(y0){function y1(){return null!==y0&&y0['apply'](this,arguments)||this;}return W(y1,y0),y1;}(K),D=function(y0){function y1(){return null!==y0&&y0['apply'](this,arguments)||this;}return W(y1,y0),y1;}(U),G=function(y0){function y1(){return null!==y0&&y0['apply'](this,arguments)||this;}return W(y1,y0),y1;}(Y),J=function(y0){function y1(){return null!==y0&&y0['apply'](this,arguments)||this;}return W(y1,y0),y1;}(U),M=function(y0){function y1(){return null!==y0&&y0['apply'](this,arguments)||this;}return W(y1,y0),y1;}(Y),z=function(y0){function y1(y2,y3){void 0x0===y3&&(y3=!0x1);var y4=y0['call'](this)||this;return y4['node']=y2,y4['shapeScale']=y3,y4;}return W(y1,y0),y1['prototype']['update']=function(y2,y3){return H(this,void 0x0,void 0x0,function(){var y4,y5,y6,y7,y8,y9,yy,yC;return E(this,function(yK){return this['loaded']?(y4=y2['transform'])?(y5=new((y9=q['Vector3'])['bind']['apply'](y9,F([void 0x0],y4['translation'],!0x1)))(),y6=new q['Vector3']()['setScalar'](y4['scale']),y7=new((yy=q['Vector3'])['bind']['apply'](yy,F([void 0x0],y4['shapeScale'],!0x1)))()['multiplyScalar'](y4['scale']),y8=new((yC=q['Quaternion'])['bind']['apply'](yC,F([void 0x0],y4['rotation'],!0x1)))(),this['node']['visible']=!0x0,this['node']['setRotationFromQuaternion'](y8),this['node']['position']['copy'](y5),this['node']['scale']['copy'](this['shapeScale']?y7:y6),[0x2,y0['prototype']['update']['call'](this,y2,y3)]):(this['node']['visible']=!0x1,[0x2,y0['prototype']['update']['call'](this,y2,y3)]):[0x2];});});},y1;}(Y),I=function(y0){function y1(y2,y3,y4){void 0x0===y3&&(y3=0x0),void 0x0===y4&&(y4=!0x1);var y5=y0['call'](this)||this;return y5['node']=y2,y5['facePoint']=y3,y5['shapeScale']=y4,y5;}return W(y1,y0),y1['prototype']['update']=function(y2,y3){return H(this,void 0x0,void 0x0,function(){var y4,y5,y6,y7,y8,y9,yy,yC,yK;return E(this,function(ye){return this['loaded']?this['node']?(y4=y2['transform'],y5=y2['metric'],y4&&y5?(y6=new((yy=q['Vector3'])['bind']['apply'](yy,F([void 0x0],y5[this['facePoint']],!0x1)))(),y7=new q['Vector3']()['setScalar'](y4['scale']),y8=new((yC=q['Vector3'])['bind']['apply'](yC,F([void 0x0],y4['shapeScale'],!0x1)))()['multiplyScalar'](y4['scale']),y9=new((yK=q['Quaternion'])['bind']['apply'](yK,F([void 0x0],y4['rotation'],!0x1)))(),this['node']['visible']=!0x0,this['node']['setRotationFromQuaternion'](y9),this['node']['position']['copy'](y6),this['node']['scale']['copy'](this['shapeScale']?y8:y7),[0x2,y0['prototype']['update']['call'](this,y2,y3)]):(this['node']['visible']=!0x1,[0x2,y0['prototype']['update']['call'](this,y2,y3)])):[0x2,y0['prototype']['update']['call'](this,y2,y3)]:[0x2];});});},y1;}(Y),Q=function(y0){function y1(y2){var y3=y0['call'](this)||this;return y3['url']=y2,y3;}return W(y1,y0),y1['prototype']['load']=function(y2){return H(this,void 0x0,void 0x0,function(){var y3,y4,y5;return E(this,function(y6){return this['loaded']||!y2?[0x2]:((y3=new q['BufferGeometry']())['setIndex'](N),y3['setAttribute']('position',new q['Float32BufferAttribute'](new Float32Array(0x57c),0x3)),y3['setAttribute']('uv',new q['Float32BufferAttribute'](O['flat'](),0x2)),y3['computeVertexNormals'](),(y4=new q['TextureLoader']()['load'](this['url']))['flipY']=!0x1,y5=new q['MeshStandardMaterial']({'map':y4,'transparent':!0x0}),this['mask']=new q['Mesh'](y3,y5),y2['add'](this['mask']),[0x2,y0['prototype']['load']['call'](this,y2)]);});});},y1['prototype']['unload']=function(){var y2,y3,y4,y5,y6;this['loaded']&&(null===(y2=this['mask'])||void 0x0===y2||y2['removeFromParent'](),null===(y3=this['mask'])||void 0x0===y3||y3['geometry']['dispose'](),null===(y5=null===(y4=this['mask'])||void 0x0===y4?void 0x0:y4['material']['map'])||void 0x0===y5||y5['dispose'](),null===(y6=this['mask'])||void 0x0===y6||y6['material']['dispose'](),delete this['mask'],y0['prototype']['unload']['call'](this));},y1['prototype']['update']=function(y2,y3){return H(this,void 0x0,void 0x0,function(){var y4,y5;return E(this,function(y6){return this['loaded']?this['mask']?(y4=y2['metric'])?(this['mask']['visible']=!0x0,y5=this['mask']['geometry']['getAttribute']('position'),y4['forEach'](function(y7,y8){return y5['setXYZ'](y8,y7[0x0],y7[0x1],y7[0x2]);}),this['mask']['geometry']['computeVertexNormals'](),y5['needsUpdate']=!0x0,[0x2,y0['prototype']['update']['call'](this,y2,y3)]):(this['mask']['visible']=!0x1,[0x2,y0['prototype']['update']['call'](this,y2,y3)]):[0x2,y0['prototype']['update']['call'](this,y2,y3)]:[0x2];});});},y1;}(Y),P=function(y0){function y1(){return null!==y0&&y0['apply'](this,arguments)||this;}return W(y1,y0),y1['prototype']['update']=function(y2,y3,y4){return H(this,void 0x0,void 0x0,function(){var y5,y6,y7,y8,y9,yy,yC,yK,ye,yV,yq,yb,yN,yO,yx,yR,yA,yk,yW;return E(this,function(yo){if(!(y5=y2['mesh']))return[0x2,y0['prototype']['update']['call'](this,y2,y3,y4)];for(y6=y4['canvas'],y7=y6['width'],y8=y6['height'],y5['keypoints']['forEach'](function(yL){return y4['fillRect'](yL[0x0]*y7-0x2,yL[0x1]*y8-0x2,0x4,0x4);}),y4['lineWidth']=0x4,y4['strokeStyle']='rgba(93,\x20111,\x20227,\x200.75)',y9=F([],x['lipsLowerOuter'],!0x0)['reverse'](),this['drawPath'](y4,F(F([],x['lipsUpperOuter'],!0x0),y9,!0x0)['map'](function(yL){return y5['keypoints'][yL];}),!0x0),yy=F([],x['lipsLowerInner'],!0x0)['reverse'](),this['drawPath'](y4,F(F([],x['lipsUpperInner'],!0x0),yy,!0x0)['map'](function(yL){return y5['keypoints'][yL];}),!0x0),y4['strokeStyle']='rgba(172,\x20110,\x20255,\x200.75)',yC=F([],x['rightEyeLower0'],!0x0)['reverse'](),this['drawPath'](y4,F(F([],x['rightEyeUpper0'],!0x0),yC,!0x0)['map'](function(yL){return y5['keypoints'][yL];}),!0x0),yK=F([],x['rightEyeLower1'],!0x0)['reverse'](),this['drawPath'](y4,F(F([],x['rightEyeUpper1'],!0x0),yK,!0x0)['map'](function(yL){return y5['keypoints'][yL];}),!0x0),ye=F([],x['leftEyeLower0'],!0x0)['reverse'](),this['drawPath'](y4,F(F([],x['leftEyeUpper0'],!0x0),ye,!0x0)['map'](function(yL){return y5['keypoints'][yL];}),!0x0),yV=F([],x['leftEyeLower1'],!0x0)['reverse'](),this['drawPath'](y4,F(F([],x['leftEyeUpper1'],!0x0),yV,!0x0)['map'](function(yL){return y5['keypoints'][yL];}),!0x0),y4['strokeStyle']='rgba(94,\x20214,\x20202,\x200.75)',yq=F([],x['rightEyebrowLower'],!0x0)['reverse'](),this['drawPath'](y4,F(F([],x['rightEyebrowUpper'],!0x0),yq,!0x0)['map'](function(yL){return y5['keypoints'][yL];}),!0x0),yb=F([],x['leftEyebrowLower'],!0x0)['reverse'](),this['drawPath'](y4,F(F([],x['leftEyebrowUpper'],!0x0),yb,!0x0)['map'](function(yL){return y5['keypoints'][yL];}),!0x0),y5['keypoints']['length']>0x1d4&&(y4['strokeStyle']='rgba(218,\x2060,\x20202,\x200.75)',this['drawPath'](y4,F([],x['rightEyeIris']['slice'](0x1),!0x0)['map'](function(yL){return y5['keypoints'][yL];}),!0x0),this['drawPath'](y4,F([],x['leftEyeIris']['slice'](0x1),!0x0)['map'](function(yL){return y5['keypoints'][yL];}),!0x0),yN=y5['keypoints'][x['rightEyeIris'][0x0]],yO=y5['keypoints'][x['leftEyeIris'][0x0]],yx=y4['canvas'],yR=yx['width'],yA=yx['height'],y4['beginPath'](),y4['ellipse'](yN[0x0]*yR,yN[0x1]*yA,0x3,0x3,0x0,0x0,0x2*Math['PI']),y4['stroke'](),y4['beginPath'](),y4['ellipse'](yO[0x0]*yR,yO[0x1]*yA,0x3,0x3,0x0,0x0,0x2*Math['PI']),y4['stroke']()),y4['lineWidth']=0.5,y4['strokeStyle']='rgba(180,\x20180,\x20180,\x200.75)',yk=0x0;yk<N['length']/0x3;yk++)yW=[N[0x3*yk],N[0x3*yk+0x1],N[0x3*yk+0x2]]['map'](function(yL){return y5['keypoints'][yL];}),this['drawPath'](y4,yW,!0x0);return[0x2,y0['prototype']['update']['call'](this,y2,y3,y4)];});});},y1['prototype']['drawPath']=function(y2,y3,y4){var y5=y2['canvas'],y6=y5['width'],y7=y5['height'],y8=new Path2D();y8['moveTo'](y3[0x0][0x0]*y6,y3[0x0][0x1]*y7);for(var y9=0x1;y9<y3['length'];y9++)y8['lineTo'](y3[y9][0x0]*y6,y3[y9][0x1]*y7);y4&&y8['closePath'](),y2['stroke'](y8);},y1;}(V),T=function(y0){function y1(y2,y3){void 0x0===y3&&(y3={'spineCurve':0.5,'neckAdjust':0.01,'headRatio':0.32,'shoulderDY':-0.01,'shoulderDZ':0.005});var y4=y0['call'](this)||this;return y4['node']=y2,y4['tune']=y3,y4['avatarLength']=0x1,y4['alignScore']=0.9,y4['alignVisibility']=0.9,y4;}return W(y1,y0),y1['prototype']['load']=function(y2){return H(this,void 0x0,void 0x0,function(){return E(this,function(y3){switch(y3['label']){case 0x0:return this['loaded']||!y2?[0x2]:[0x4,y0['prototype']['load']['call'](this,y2)];case 0x1:return y3['sent'](),[0x4,this['setNode'](this['node'])];case 0x2:return y3['sent'](),[0x2];}});});},y1['prototype']['unload']=function(){this['loaded']&&(delete this['node'],delete this['skeleton'],delete this['skeletonRef'],delete this['spineRef'],y0['prototype']['unload']['call'](this));},y1['prototype']['setNode']=function(y2){var y3;return H(this,void 0x0,void 0x0,function(){var y4,y5,y6,y7,y8,y9,yy,yC,yK,ye,yV,yq,yb,yN,yO,yx,yR,yA,yk,yW,yo,yL,yH=this;return E(this,function(yd){return delete this['skeleton'],delete this['skeletonRef'],delete this['spineRef'],this['node']=y2,this['loaded']&&y2?(y2['traverse'](function(yt){!yH['skeletonRef']&&yt instanceof q['SkinnedMesh']&&(yH['skeletonRef']=yt['skeleton']);}),(y4=null===(y3=this['skeletonRef'])||void 0x0===y3?void 0x0:y3['bones'])?(y5={'hips':y4['find'](function(yt){return yt['name']['endsWith']('Hips');}),'spine':y4['find'](function(yt){return yt['name']['endsWith']('Spine');}),'spine1':y4['find'](function(yt){return yt['name']['endsWith']('Spine1');}),'spine2':y4['find'](function(yt){return yt['name']['endsWith']('Spine2');}),'neck':y4['find'](function(yt){return yt['name']['endsWith']('Neck');}),'head':y4['find'](function(yt){return yt['name']['endsWith']('Head');}),'headEnd':y4['find'](function(yt){return yt['name']['endsWith']('HeadTop_End');}),'shoulderL':y4['find'](function(yt){return yt['name']['endsWith']('LeftShoulder');}),'shoulderR':y4['find'](function(yt){return yt['name']['endsWith']('RightShoulder');}),'armL':y4['find'](function(yt){return yt['name']['endsWith']('LeftArm');}),'armR':y4['find'](function(yt){return yt['name']['endsWith']('RightArm');}),'foreArmL':y4['find'](function(yt){return yt['name']['endsWith']('LeftForeArm');}),'foreArmR':y4['find'](function(yt){return yt['name']['endsWith']('RightForeArm');}),'handL':y4['find'](function(yt){return yt['name']['endsWith']('LeftHand');}),'handR':y4['find'](function(yt){return yt['name']['endsWith']('RightHand');}),'upLegL':y4['find'](function(yt){return yt['name']['endsWith']('LeftUpLeg');}),'upLegR':y4['find'](function(yt){return yt['name']['endsWith']('RightUpLeg');}),'legL':y4['find'](function(yt){return yt['name']['endsWith']('LeftLeg');}),'legR':y4['find'](function(yt){return yt['name']['endsWith']('RightLeg');}),'footL':y4['find'](function(yt){return yt['name']['endsWith']('LeftFoot');}),'footR':y4['find'](function(yt){return yt['name']['endsWith']('RightFoot');}),'toeL':y4['find'](function(yt){return yt['name']['endsWith']('LeftToeBase');}),'toeR':y4['find'](function(yt){return yt['name']['endsWith']('RightToeBase');})},this['skeleton']=y5,y6=y5['hips']['getWorldPosition'](new q['Vector3']()),y7=y5['armL']['getWorldPosition'](new q['Vector3']()),y8=y5['armR']['getWorldPosition'](new q['Vector3']()),y9=y7['clone']()['lerp'](y8,0.5)['sub'](y6),yy=y9['length'](),yC=y7['clone']()['sub'](y6),yK=y8['clone']()['sub'](y6),ye=yK['clone']()['cross'](yC)['normalize'](),yV=y5['spine']['getWorldPosition'](new q['Vector3']())['sub'](y6),yq=yV['dot'](ye),yb=yV['clone']()['sub'](ye['clone']()['multiplyScalar'](yq))['length'](),yN=y5['spine1']['getWorldPosition'](new q['Vector3']())['sub'](y6),yO=yN['dot'](ye),yx=yN['clone']()['sub'](ye['clone']()['multiplyScalar'](yO))['length'](),yR=y5['spine2']['getWorldPosition'](new q['Vector3']())['sub'](y6),yA=yR['dot'](ye),yk=yR['clone']()['sub'](ye['clone']()['multiplyScalar'](yA))['length'](),yW=y5['head']['getWorldPosition'](new q['Vector3']()),yo=y5['headEnd']['getWorldPosition'](new q['Vector3']()),yL=yo['clone']()['sub'](yW)['length'](),this['avatarLength']=yy,this['spineRef']={'spine':[yb/yy,yq/yy],'spine1':[yx/yy,yO/yy],'spine2':[yk/yy,yA/yy],'head':[yL/yy,0x0]},y2['traverse'](function(yt){yt['frustumCulled']=!0x1;}),[0x2]):[0x2]):[0x2];});});},y1['prototype']['update']=function(y2,y3){var y4;return H(this,void 0x0,void 0x0,function(){var y5,y6,y7,y8,y9,yy;return E(this,function(yC){return y5=y2['poses']['length']>0x0?y2['poses'][0x0]['points']:void 0x0,y7=(y6=this)['node'],y8=y6['skeleton'],y9=y6['spineRef'],y7?y8&&y9&&y5?(yy=this['estimateBones'](y5,y9),y7['visible']=!0x0,null===(y4=this['skeletonRef'])||void 0x0===y4||y4['pose'](),this['updateSpine'](yy),this['updateHandL'](yy,y5),this['updateHandR'](yy,y5),this['updateLegL'](yy,y5),this['updateLegR'](yy,y5),[0x2,y0['prototype']['update']['call'](this,y2,y3)]):(y7['visible']=!0x1,[0x2,y0['prototype']['update']['call'](this,y2,y3)]):[0x2,y0['prototype']['update']['call'](this,y2,y3)];});});},y1['prototype']['updateSpine']=function(y2){var y3,y4=this['skeleton'],y5=this['spineRef'];if(y4&&y5){this['alignBone'](y2['hips'],y4['hips'],!0x1),this['alignBone'](y2['spine'],y4['spine']),this['alignBone'](y2['spine1'],y4['spine1']),this['alignBone'](y2['spine2'],y4['spine2']),this['alignBone'](y2['neck'],y4['neck'],!0x1),this['alignBone'](y2['head'],y4['head'],!0x1);var y6=null===(y3=this['skeletonRef'])||void 0x0===y3?void 0x0:y3['bones']['find'](function(y9){return y9['name']['endsWith']('HeadEnd');});if(y6){var y7=y2['head'],y8=y2['headEnd']['position']['clone']()['sub'](y7['position'])['length']();y4['head']['scale']['setScalar'](1.05*y8/y6['position']['length']());}this['alignBone'](y2['shoulderL'],y4['shoulderL'],!0x1),this['alignBone'](y2['shoulderR'],y4['shoulderR'],!0x1);}},y1['prototype']['updateHandL']=function(y2,y3){var y4=this['skeleton'],y5=this['spineRef'];if(y4&&y5){var y6=this['alignScore'],y7=this['alignVisibility'];this['alignBone'](y2['armL'],y4['armL']),y3['elbowL']['score']<y6&&y3['elbowL']['visibility']<y7||(this['alignBone'](y2['foreArmL'],y4['foreArmL']),this['alignBone'](y2['handL'],y4['handL']),y4['handL']['scale']['setScalar'](0.95));}},y1['prototype']['updateHandR']=function(y2,y3){var y4=this['skeleton'];if(y4){var y5=this['alignScore'],y6=this['alignVisibility'];this['alignBone'](y2['armR'],y4['armR']),y3['elbowR']['score']<y5&&y3['elbowR']['visibility']<y6||(this['alignBone'](y2['foreArmR'],y4['foreArmR']),this['alignBone'](y2['handR'],y4['handR']),y4['handR']['scale']['setScalar'](0.95));}},y1['prototype']['updateLegL']=function(y2,y3){var y4=this['skeleton'];if(y4){var y5=this['alignScore'],y6=this['alignVisibility'];y3['hipL']['score']<y5&&y3['hipL']['visibility']<y6||(this['alignBone'](y2['upLegL'],y4['upLegL'],!0x1),y3['kneeL']['score']<y5&&y3['kneeL']['visibility']<y6||(this['alignBone'](y2['legL'],y4['legL']),y3['ankleL']['score']<y5&&y3['ankleL']['visibility']<y6||(this['alignBone'](y2['footL'],y4['footL']),this['alignBone'](y2['toeL'],y4['toeL']))));}},y1['prototype']['updateLegR']=function(y2,y3){var y4=this['skeleton'];if(y4){var y5=this['alignScore'],y6=this['alignVisibility'];y3['hipR']['score']<y5&&y3['hipR']['visibility']<y6||(this['alignBone'](y2['upLegR'],y4['upLegR'],!0x1),y3['kneeR']['score']<y5&&y3['kneeR']['visibility']<y6||(this['alignBone'](y2['legR'],y4['legR']),y3['ankleR']['score']<y5&&y3['ankleR']['visibility']<y6||(this['alignBone'](y2['footR'],y4['footR']),this['alignBone'](y2['toeR'],y4['toeR']))));}},y1['prototype']['estimateBones']=function(y2,y3){var y4,y5,y6,y7,y8,y9,yy,yC,yK,yV,yq,yb,yN,yO,yx,yR,yA,yk,yW,yo,yL,yH,yd,yt,yi=new((y4=q['Vector3'])['bind']['apply'](y4,F([void 0x0],y2['hipL']['metric'],!0x1)))(),ym=new((y5=q['Vector3'])['bind']['apply'](y5,F([void 0x0],y2['hipR']['metric'],!0x1)))(),yw=yi['clone']()['lerp'](ym,0.5),yE=yi['clone']()['sub'](ym)['normalize'](),yF=yE['clone']()['negate'](),yU=new((y6=q['Vector3'])['bind']['apply'](y6,F([void 0x0],y2['shoulderL']['metric'],!0x1)))(),yY=new((y7=q['Vector3'])['bind']['apply'](y7,F([void 0x0],y2['shoulderR']['metric'],!0x1)))(),yS=new((y8=q['Vector3'])['bind']['apply'](y8,F([void 0x0],y2['elbowL']['metric'],!0x1)))(),yD=new((y9=q['Vector3'])['bind']['apply'](y9,F([void 0x0],y2['elbowR']['metric'],!0x1)))(),yB=yU['clone']()['lerp'](yY,0.5),yG=yU['clone']()['sub'](yY)['normalize'](),ya=yU['clone']()['sub'](yw),yJ=yY['clone']()['sub'](yw)['clone']()['cross'](ya)['normalize']();if(this['tune']['shoulderDX']||this['tune']['shoulderDY']||this['tune']['shoulderDZ']){var yf=yG['clone']()['multiplyScalar'](this['tune']['shoulderDX']||0x0),yn=yB['clone']()['sub'](yw)['normalize']()['multiplyScalar'](this['tune']['shoulderDY']||0x0)['add'](yJ['clone']()['multiplyScalar']((null===(yt=this['tune'])||void 0x0===yt?void 0x0:yt['shoulderDZ'])||0x0));yU['add'](yn)['add'](yf),yY['add'](yn)['add'](yf['clone']()['negate']());}var yv,yM=yU['clone']()['lerp'](yY,0.5),yz=yM['clone']()['sub'](yw)['normalize'](),yc=yS['clone']()['sub'](yU)['normalize'](),ys=yD['clone']()['sub'](yY)['normalize']();if(this['tune']['neckAdjust']){var yh=Math['abs'](yG['x']);yv=yz['clone']()['multiplyScalar'](yh*(yz['dot'](yc)*-this['tune']['neckAdjust']+yz['dot'](ys)*-this['tune']['neckAdjust'])),yM['add'](yv);}var yI=yM['clone']()['sub'](yw)['length'](),yQ=this['tune']['shoulderOffset']||0.2,yg=yM['clone']()['lerp'](yU,yQ),yP=yM['clone']()['lerp'](yY,yQ),yT=new((yy=q['Vector3'])['bind']['apply'](yy,F([void 0x0],y2['earL']['metric'],!0x1)))(),yl=new((yC=q['Vector3'])['bind']['apply'](yC,F([void 0x0],y2['earR']['metric'],!0x1)))(),yp=yT['clone']()['lerp'](yl,0.5),yZ=new((yK=q['Vector3'])['bind']['apply'](yK,F([void 0x0],y2['nose']['metric'],!0x1)))(),yr=yp['clone']()['sub'](yZ)['normalize'](),yu=yT['clone']()['sub'](yl)['normalize'](),yj=yu['clone']()['cross'](yr)['add'](yr['clone']()['multiplyScalar'](0.05))['normalize'](),yX=this['tune']['headRatio']||0.32,C0=y3['head'][0x0]*yI,C1=yp['clone']()['add'](yj['clone']()['cross'](yu)['multiplyScalar'](0.025)),C2=C1['clone']()['add'](yj['clone']()['multiplyScalar'](-yX*C0)),C3=C1['clone']()['add'](yj['clone']()['multiplyScalar']((0x1-yX)*C0)),C4=C2['clone']()['lerp'](C3,0x2),C5=yG['clone']()['lerp'](yu,0.5),C6=yv?yU['clone']()['add'](yv):yU['clone'](),C7=yv?yY['clone']()['add'](yv):yY['clone'](),C8=yi['clone']()['lerp'](C6,y3['spine'][0x0]),C9=ym['clone']()['lerp'](C7,y3['spine'][0x0]),Cy=C8['clone']()['lerp'](C9,0.5),CC=C8['clone']()['sub'](C9),CK=yi['clone']()['lerp'](C6,y3['spine1'][0x0]),CV=ym['clone']()['lerp'](C7,y3['spine1'][0x0]),Cq=CK['clone']()['lerp'](CV,0.5),Cb=CK['clone']()['sub'](CV),CN=yi['clone']()['lerp'](C6,y3['spine2'][0x0]),CO=ym['clone']()['lerp'](C7,y3['spine2'][0x0]),Cx=CN['clone']()['lerp'](CO,0.5),CR=CK['clone']()['sub'](CO);if(this['tune']['spineCurve']){var CA=yU['clone']()['sub'](yw),Ck=yY['clone']()['sub'](yw)['clone']()['cross'](CA)['normalize']();yh=this['tune']['spineCurve']*yI,(Cy['add'](Ck['clone']()['multiplyScalar'](y3['spine'][0x1]*yh)),Cq['add'](Ck['clone']()['multiplyScalar'](y3['spine1'][0x1]*yh)),Cx['add'](Ck['clone']()['multiplyScalar'](y3['spine2'][0x1]*yh)));}var CW=new((yV=q['Vector3'])['bind']['apply'](yV,F([void 0x0],y2['wristL']['metric'],!0x1)))(),Co=CW['clone']()['sub'](yS)['normalize']()['clone']()['sub'](yc)['negate'](),CL=yJ['clone'](),CH=Co['clone']()['lerp'](CL,0.5),Cd=new((yq=q['Vector3'])['bind']['apply'](yq,F([void 0x0],y2['indexL']['metric'],!0x1)))(),Ct=new((yb=q['Vector3'])['bind']['apply'](yb,F([void 0x0],y2['pinkyL']['metric'],!0x1)))(),Ci=Cd['clone']()['lerp'](Ct,0.5),Cm=Ct['clone']()['sub'](Cd),Cw=new((yN=q['Vector3'])['bind']['apply'](yN,F([void 0x0],y2['wristR']['metric'],!0x1)))(),CE=Cw['clone']()['sub'](yD)['normalize']()['clone']()['sub'](ys),CF=yJ['clone']()['negate'](),CU=CE['clone']()['lerp'](CF,0.5),CY=new((yO=q['Vector3'])['bind']['apply'](yO,F([void 0x0],y2['indexR']['metric'],!0x1)))(),CS=new((yx=q['Vector3'])['bind']['apply'](yx,F([void 0x0],y2['pinkyR']['metric'],!0x1)))(),CD=CY['clone']()['lerp'](CS,0.5),CB=CY['clone']()['sub'](CS),CG=new((yR=q['Vector3'])['bind']['apply'](yR,F([void 0x0],y2['kneeL']['metric'],!0x1)))(),Ca=new((yA=q['Vector3'])['bind']['apply'](yA,F([void 0x0],y2['ankleL']['metric'],!0x1)))(),CJ=new((yk=q['Vector3'])['bind']['apply'](yk,F([void 0x0],y2['footIndexL']['metric'],!0x1)))(),Cf=new((yW=q['Vector3'])['bind']['apply'](yW,F([void 0x0],y2['heelL']['metric'],!0x1)))(),Cn=Ca['clone']()['sub'](CG)['normalize'](),Cv=CJ['clone']()['sub'](Cf)['normalize'](),CM=Cn['clone']()['cross'](Cv)['normalize'](),Cz=Cf['clone']()['lerp'](CJ,0.8),Cc=yF['clone']()['lerp'](CM,0.2),Cs=yF['clone']()['lerp'](CM,0.6),Ch=new((yo=q['Vector3'])['bind']['apply'](yo,F([void 0x0],y2['kneeR']['metric'],!0x1)))(),CI=new((yL=q['Vector3'])['bind']['apply'](yL,F([void 0x0],y2['ankleR']['metric'],!0x1)))(),CQ=new((yH=q['Vector3'])['bind']['apply'](yH,F([void 0x0],y2['footIndexR']['metric'],!0x1)))(),Cg=new((yd=q['Vector3'])['bind']['apply'](yd,F([void 0x0],y2['heelR']['metric'],!0x1)))(),CP=CI['clone']()['sub'](Ch)['normalize'](),CT=CQ['clone']()['sub'](Cg)['normalize'](),Cl=CP['clone']()['cross'](CT)['normalize'](),Cp=Cg['clone']()['lerp'](CQ,0.8),CZ=yF['clone']()['lerp'](Cl,0.2),Cr=yF['clone']()['lerp'](Cl,0.6);return{'hips':this['estimateBone'](yw,Cy,yE),'spine':this['estimateBone'](Cy,Cq,CC),'spine1':this['estimateBone'](Cq,Cx,Cb),'spine2':this['estimateBone'](Cx,yM,CR),'neck':this['estimateBone'](yM,C2,C5),'head':this['estimateBone'](C2,C3,yu),'headEnd':this['estimateBone'](C3,C4,yu),'shoulderL':this['estimateBone'](yg,yU,CL),'armL':this['estimateBone'](yU,yS,CH),'foreArmL':this['estimateBone'](yS,CW,Co),'handL':this['estimateBone'](CW,Ci,Cm),'shoulderR':this['estimateBone'](yP,yY,CF),'armR':this['estimateBone'](yY,yD,CU),'foreArmR':this['estimateBone'](yD,Cw,CE),'handR':this['estimateBone'](Cw,CD,CB),'upLegL':this['estimateBone'](yi,CG,Cc),'legL':this['estimateBone'](CG,Ca,Cs),'footL':this['estimateBone'](Ca,Cz,CM),'toeL':this['estimateBone'](Cz,CJ,CM),'upLegR':this['estimateBone'](ym,Ch,CZ),'legR':this['estimateBone'](Ch,CI,Cr),'footR':this['estimateBone'](CI,Cp,Cl),'toeR':this['estimateBone'](Cp,CQ,Cl)};},y1['prototype']['estimateBone']=function(y2,y3,y4){var y5=y3['clone']()['sub'](y2)['normalize'](),y6=y4['clone']()['normalize']()['cross'](y5)['normalize'](),y7=y5['clone']()['cross'](y6);return{'position':y2['clone'](),'rotation':new q['Quaternion']()['setFromRotationMatrix'](new q['Matrix4']()['makeBasis'](y7,y5,y6))};},y1['prototype']['alignBone']=function(y2,y3,y4){void 0x0===y4&&(y4=!0x0);var y5=y2['rotation']['clone'](),y6=y2['position']['clone']();y3['parent']&&(y5=y3['parent']['getWorldQuaternion'](new q['Quaternion']())['invert']()['multiply'](y5),y6['applyMatrix4'](y3['parent']['matrixWorld']['clone']()['invert']()),y4&&y3['parent']instanceof q['Bone']&&(y3['parent']['scale']['setScalar'](y6['length']()/y3['position']['length']()),y3['parent']['updateWorldMatrix'](!0x0,!0x0),y6=y2['position']['clone']()['applyMatrix4'](y3['parent']['matrixWorld']['clone']()['invert']()))),y3['setRotationFromQuaternion'](y5),y3['position']['copy'](y6),y3['updateWorldMatrix'](!0x0,!0x0);},y1;}(G),Z=function(y0){function y1(y2,y3,y4){void 0x0===y4&&(y4={'spineCurve':0.5,'neckAdjust':0.01,'headRatio':0.32,'shoulderDY':-0.01,'shoulderDZ':0.005});var y5=y0['call'](this,y2,y4)||this;return y5['outfit']=y3,y5;}return W(y1,y0),y1['prototype']['setNode']=function(y2){return H(this,void 0x0,void 0x0,function(){var y3,y4,y5;return E(this,function(y6){switch(y6['label']){case 0x0:return[0x4,y0['prototype']['setNode']['call'](this,y2)];case 0x1:return y6['sent'](),y4=(y3=this)['outfit'],y5=y3['node'],y4&&y5?(y5['traverse'](function(y7){if(y7 instanceof q['Mesh']){var y8=function(y9){return null==y9?void 0x0:y9['some'](function(yy){return'string'==typeof yy?y7['name']===yy:yy['test'](y7['name']);});};if(y8(y4['occluders']))return y7['material']['colorWrite']=!0x1,void(y7['renderOrder']=-0x1);y8(y4['hidden'])&&(y7['visible']=!0x1);}}),[0x2]):[0x2];}});});},y1['prototype']['setOutfit']=function(y2,y3){return H(this,void 0x0,void 0x0,function(){return E(this,function(y4){return this['outfit']=y3,[0x2,this['setNode'](y2)];});});},y1;}(T),j=function(y0){function y1(y2,y3,y4,y5,y6){void 0x0===y6&&(y6={'spineCurve':0.5,'neckAdjust':0.01,'headRatio':0.32,'shoulderDY':-0.01,'shoulderDZ':0.005});var y7=y0['call'](this,y2,y6)||this;return y7['translation']=y3,y7['rotation']=y4,y7['scale']=y5,y7;}return W(y1,y0),y1['prototype']['update']=function(y2,y3){return H(this,void 0x0,void 0x0,function(){var y4,y5,y6,y7,y8,y9,yy,yC,yK,ye,yV;return E(this,function(yq){switch(yq['label']){case 0x0:return[0x4,y0['prototype']['update']['call'](this,y2,y3)];case 0x1:return yq['sent'](),y4=y2['poses']['length']>0x0?y2['poses'][0x0]['points']:void 0x0,y6=(y5=this)['node'],y7=y5['translation'],y8=y5['rotation'],y9=y5['scale'],y6&&y4?(yy=new((ye=q['Vector3'])['bind']['apply'](ye,F([void 0x0],y4['hipL']['metric'],!0x1)))(),yC=new((yV=q['Vector3'])['bind']['apply'](yV,F([void 0x0],y4['hipR']['metric'],!0x1)))(),yK=yy['clone']()['lerp'](yC,0.5),y6['position']['copy'](y7?yK['add'](y7):yK),y8&&y6['setRotationFromQuaternion'](y8),y9&&y6['scale']['setScalar'](y9),[0x2]):[0x2];}});});},y1['prototype']['updateSpine']=function(y2){var y3=this['skeleton'],y4=this['spineRef'];y3&&y4&&(this['alignBone'](y2['hips'],y3['hips']),this['alignBone'](y2['spine'],y3['spine']),this['alignBone'](y2['spine1'],y3['spine1']),this['alignBone'](y2['spine2'],y3['spine2']),this['alignBone'](y2['neck'],y3['neck']),this['alignBone'](y2['head'],y3['head']),this['alignBone'](y2['shoulderL'],y3['shoulderL']),this['alignBone'](y2['shoulderR'],y3['shoulderR']));},y1['prototype']['alignBone']=function(y2,y3){var y4=y2['rotation']['clone']();y3['parent']&&(y4=y3['parent']['getWorldQuaternion'](new q['Quaternion']())['invert']()['multiply'](y4)),y3['setRotationFromQuaternion'](y4),y3['updateWorldMatrix'](!0x0,!0x0);},y1;}(T),X=function(y0){function y1(y2,y3){void 0x0===y3&&(y3=-0x1);var y4=y0['call'](this)||this;return y4['node']=y2,y4['renderOrder']=y3,y4;}return W(y1,y0),y1['prototype']['load']=function(y2){return H(this,void 0x0,void 0x0,function(){var y3=this;return E(this,function(y4){return this['loaded']||!y2?[0x2]:(this['node']['traverse'](function(y5){y5 instanceof q['Mesh']&&(y5['material']['colorWrite']=!0x1),y5['renderOrder']=y3['renderOrder'];}),[0x2,y0['prototype']['load']['call'](this,y2)]);});});},y1;}(Y);export{P as FaceDebugPlugin,Q as FaceMaskPlugin,M as FacePlugin,J as FaceRenderer,I as FaceTrackPlugin,z as HeadTrackPlugin,X as OccluderPlugin,T as PoseAlignPlugin,Z as PoseOutfitPlugin,G as PosePlugin,D as PoseRenderer,j as PoseTwinPlugin,Y as ThreePlugin,U as ThreeRenderer};
