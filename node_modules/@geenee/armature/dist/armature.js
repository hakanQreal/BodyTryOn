import{EventEmitter as Z}from'events';var J=function(k,j){return J=Object['setPrototypeOf']||{'__proto__':[]}instanceof Array&&function(F,P){F['__proto__']=P;}||function(F,P){for(var B in P)Object['prototype']['hasOwnProperty']['call'](P,B)&&(F[B]=P[B]);},J(k,j);};function A(k,j){if('function'!=typeof j&&null!==j)throw new TypeError('Class\x20extends\x20value\x20'+String(j)+'\x20is\x20not\x20a\x20constructor\x20or\x20null');function F(){this['constructor']=k;}J(k,j),k['prototype']=null===j?Object['create'](j):(F['prototype']=j['prototype'],new F());}var C=function(){return C=Object['assign']||function(k){for(var j,F=0x1,P=arguments['length'];F<P;F++)for(var B in j=arguments[F])Object['prototype']['hasOwnProperty']['call'](j,B)&&(k[B]=j[B]);return k;},C['apply'](this,arguments);};function U(k,j,F,P){return new(F||(F=Promise))(function(B,Q){function Z0(Z3){try{Z2(P['next'](Z3));}catch(Z4){Q(Z4);}}function Z1(Z3){try{Z2(P['throw'](Z3));}catch(Z4){Q(Z4);}}function Z2(Z3){var Z4;Z3['done']?B(Z3['value']):(Z4=Z3['value'],Z4 instanceof F?Z4:new F(function(Z5){Z5(Z4);}))['then'](Z0,Z1);}Z2((P=P['apply'](k,j||[]))['next']());});}function T(k,j){var F,P,B,Q,Z0={'label':0x0,'sent':function(){if(0x1&B[0x0])throw B[0x1];return B[0x1];},'trys':[],'ops':[]};return Q={'next':Z1(0x0),'throw':Z1(0x1),'return':Z1(0x2)},'function'==typeof Symbol&&(Q[Symbol['iterator']]=function(){return this;}),Q;function Z1(Z2){return function(Z3){return function(Z4){if(F)throw new TypeError('Generator\x20is\x20already\x20executing.');for(;Z0;)try{if(F=0x1,P&&(B=0x2&Z4[0x0]?P['return']:Z4[0x0]?P['throw']||((B=P['return'])&&B['call'](P),0x0):P['next'])&&!(B=B['call'](P,Z4[0x1]))['done'])return B;switch(P=0x0,B&&(Z4=[0x2&Z4[0x0],B['value']]),Z4[0x0]){case 0x0:case 0x1:B=Z4;break;case 0x4:return Z0['label']++,{'value':Z4[0x1],'done':!0x1};case 0x5:Z0['label']++,P=Z4[0x1],Z4=[0x0];continue;case 0x7:Z4=Z0['ops']['pop'](),Z0['trys']['pop']();continue;default:if(!(B=Z0['trys'],(B=B['length']>0x0&&B[B['length']-0x1])||0x6!==Z4[0x0]&&0x2!==Z4[0x0])){Z0=0x0;continue;}if(0x3===Z4[0x0]&&(!B||Z4[0x1]>B[0x0]&&Z4[0x1]<B[0x3])){Z0['label']=Z4[0x1];break;}if(0x6===Z4[0x0]&&Z0['label']<B[0x1]){Z0['label']=B[0x1],B=Z4;break;}if(B&&Z0['label']<B[0x2]){Z0['label']=B[0x2],Z0['ops']['push'](Z4);break;}B[0x2]&&Z0['ops']['pop'](),Z0['trys']['pop']();continue;}Z4=j['call'](k,Z0);}catch(Z5){Z4=[0x6,Z5],P=0x0;}finally{F=B=0x0;}if(0x5&Z4[0x0])throw Z4[0x1];return{'value':Z4[0x0]?Z4[0x1]:void 0x0,'done':!0x0};}([Z2,Z3]);};}}var X=function(k){function j(){return null!==k&&k['apply'](this,arguments)||this;}return A(j,k),j;}(Z),D=(function(){function k(j){void 0x0===j&&(j='canvas'),this['size']={'width':0x0,'height':0x0},this['context']=null,this['canvas']=document['createElement']('canvas'),this['canvas']['id']='engeenee.capture.'+j,this['canvas']['hidden']=!0x0,this['context']=this['canvas']['getContext']('2d',{'alpha':!0x1});}return k['prototype']['capture']=function(j){var F=this['context'];if(!F)return!0x1;var P=this['size'],B=P['width'],Q=P['height'];return F['drawImage'](j,0x0,0x0,B,Q),!0x0;},k['prototype']['data']=function(){var j=this['context'];if(j){var F=this['size'],P=F['width'],B=F['height'];return j['getImageData'](0x0,0x0,P,B);}},k['prototype']['setSize']=function(j){this['size']=C({},j),this['canvas']['width']=j['width'],this['canvas']['height']=j['height'];},k['prototype']['fill']=function(){var j=this['context'];j&&(j['fillStyle']='rgba(255,\x20255,\x20255,\x201)',j['fillRect'](0x0,0x0,this['size']['width'],this['size']['height']));},k['prototype']['dispose']=function(){this['context']=null,this['canvas']['remove']();},k;}()),I=function(k){function j(){var F=k['call'](this)||this;return F['buffer']=new D('capture'),F['captureTime']=0x0,F;}return A(j,k),j['prototype']['setup']=function(F){return U(this,void 0x0,void 0x0,function(){var P,B;return T(this,function(Q){return P=function(Z0){return'string'!=typeof Z0&&'size'in Z0;},B=F&&P(F)&&F['size']||{'width':0x780,'height':0x438},this['updateSize'](B),this['buffer']['fill'](),[0x2,!0x0];});});},j['prototype']['dispose']=function(){this['reset'](),this['buffer']['dispose']();},j['prototype']['start']=function(){return U(this,void 0x0,void 0x0,function(){return T(this,function(F){return this['captureTime']=0x0,this['timer']=Date['now'](),[0x2];});});},j['prototype']['pause']=function(){},j['prototype']['reset']=function(){this['pause'](),delete this['timer'];},j['prototype']['capture']=function(){return void 0x0!==this['timer']&&(this['captureTime']=0x3e8*(Date['now']()-this['timer']),!0x0);},j['prototype']['size']=function(){return C({},this['buffer']['size']);},j['prototype']['ratio']=function(){var F=this['buffer']['size'];return F['width']/F['height'];},j['prototype']['updateSize']=function(F){this['buffer']['setSize'](F),this['emit']('resize',this['buffer']['size']);},j;}(X),Y=function(k){function j(){var F=k['call'](this)||this;return F['timeShift']=0x0,F['videoRef']=document['createElement']('video'),F['videoRef']['id']='engeenee.capture.source',F['videoRef']['muted']=!0x0,F['videoRef']['loop']=!0x0,F['videoRef']['playsInline']=!0x0,F;}return A(j,k),j['prototype']['setup']=function(F){return U(this,void 0x0,void 0x0,function(){var P,B,Q,Z0,Z1,Z2,Z3=this;return T(this,function(Z4){switch(Z4['label']){case 0x0:return P=function(Z5){return'string'==typeof Z5||'getVideoTracks'in Z5;},B=function(Z5){return'video'in Z5;},Q=function(Z5){if(!Z5)return{'video':!0x0,'audio':!0x1};if(B(Z5))return Z5;var Z6=Z5['size'];return{'video':{'facingMode':Z5['rear']?'environment':'user','width':null==Z6?void 0x0:Z6['width'],'height':null==Z6?void 0x0:Z6['height']},'audio':!0x1};},void 0x0!==F&&P(F)?(Z1=F,[0x3,0x3]):[0x3,0x1];case 0x1:return[0x4,navigator['mediaDevices']['getUserMedia'](Q(F))['catch'](function(){})];case 0x2:Z1=Z4['sent'](),Z4['label']=0x3;case 0x3:return(Z0=Z1)?(Z2=this['videoRef'],[0x2,new Promise(function(Z5){Z2['onloadedmetadata']=function(){Z3['updateSize']({'width':Z2['videoWidth'],'height':Z2['videoHeight']}),Z2['onresize']=function(){Z3['updateSize']({'width':Z2['videoWidth'],'height':Z2['videoHeight']});},Z2['onseeked']=function(){Z3['timeShift']=Z3['captureTime'],Z3['captureTime']=0x0;},Z5(!0x0);},'string'==typeof Z0?Z2['src']=Z0:Z2['srcObject']=Z0;})]):[0x2,!0x1];}});});},j['prototype']['dispose']=function(){k['prototype']['dispose']['call'](this),this['videoRef']['remove']();},j['prototype']['start']=function(){return U(this,void 0x0,void 0x0,function(){return T(this,function(F){switch(F['label']){case 0x0:return this['captureTime']=0x0,this['timeShift']=0x0,this['videoRef']['srcObject']||this['videoRef']['src']?[0x4,this['videoRef']['play']()]:[0x3,0x2];case 0x1:F['sent'](),F['label']=0x2;case 0x2:return[0x2];}});});},j['prototype']['pause']=function(){this['videoRef']['pause']();},j['prototype']['reset']=function(){this['pause'](),this['videoRef']['srcObject']&&(this['videoRef']['srcObject']['getTracks']()['forEach'](function(F){return F['stop']();}),this['videoRef']['srcObject']=null);},j['prototype']['capture']=function(){var F=this['videoRef'],P=this['buffer'],B=F['currentTime']+this['timeShift'];return!(B<=this['captureTime'])&&(this['captureTime']=B,P['capture'](F));},j;}(I),M=function(k){function j(F,P,B){void 0x0===B&&(B=Y);var Q=k['call'](this)||this;return Q['engineParams']=P,Q['renderers']=[],Q['videoRatio']=0x780/0x438,Q['streamSize']={'width':0x780,'height':0x438},Q['processSize']={'width':0x780,'height':0x438},Q['resizeEnabled']=!0x1,Q['loopState']=!0x1,Q['init']=function(Z0){return U(Q,void 0x0,void 0x0,function(){var Z1;return T(this,function(Z2){switch(Z2['label']){case 0x0:return[0x4,this['setupProcessor'](Z0)];case 0x1:return Z1=Z2['sent'](),this['emit']('init',Z1),[0x2,Z1];}});});},Q['setup']=function(Z0){return U(Q,void 0x0,void 0x0,function(){var Z1;return T(this,function(Z2){switch(Z2['label']){case 0x0:return this['pause'](),[0x4,this['setupVideo'](Z0)];case 0x1:return Z1=Z2['sent'](),this['emit']('setup',Z1),[0x2,Z1];}});});},Q['start']=function(){return U(Q,void 0x0,void 0x0,function(){return T(this,function(Z0){switch(Z0['label']){case 0x0:return[0x4,this['video']['start']()];case 0x1:return Z0['sent'](),this['loopState']=!0x0,this['emit']('start'),this['enqueue'](),[0x2];}});});},Q['pause']=function(){Q['loopState']=!0x1,Q['loopId']&&(window['cancelAnimationFrame'](Q['loopId']),delete Q['loopId']),Q['video']['pause'](),Q['emit']('pause');},Q['reset']=function(){Q['pause'](),Q['video']['reset'](),delete Q['streamCanvas'],delete Q['processCanvas'],Q['processor']['reset']();},Q['iterate']=function(){return U(Q,void 0x0,void 0x0,function(){var Z0,Z1,Z2,Z3,Z4,Z5;return T(this,function(Z6){switch(Z6['label']){case 0x0:return Z1=(Z0=this)['video'],Z2=Z0['streamCanvas'],Z3=Z0['processCanvas'],Z1['capture']()&&Z2&&Z3?(this['resizeEnabled']&&(null===(Z5=this['resizeBuffer'])||void 0x0===Z5||Z5['capture'](Z1['buffer']['canvas'])),[0x4,this['processor']['process'](Z3,Z1['captureTime'])]):[0x2,this['enqueue']()];case 0x1:return Z4=Z6['sent'](),Z4?[0x4,Promise['all'](this['renderers']['map'](function(Z7){return Z7['update'](Z4,Z2);}))]:[0x3,0x3];case 0x2:Z6['sent'](),Z6['label']=0x3;case 0x3:return this['enqueue'](),[0x2];}});});},Q['processor']=new F(),Q['video']=new B(),Q['video']['on']('resize',Q['resizeVideo']['bind'](Q)),Q;}return A(j,k),j['prototype']['addRenderer']=function(F){return U(this,void 0x0,void 0x0,function(){return T(this,function(P){switch(P['label']){case 0x0:return this['renderers']['push'](F),[0x4,F['load']()];case 0x1:return P['sent'](),F['setupVideo'](this['video']['size'](),this['video']['ratio']()),F['setupCamera'](this['processor']['cameraRatio'],this['processor']['cameraAngle']),[0x2];}});});},j['prototype']['removeRenderer']=function(F){var P=this['renderers'],B=P['indexOf'](F);B<0x0||(P[B]['dispose'](),P['slice'](B,0x1));},j['prototype']['enqueue']=function(){this['loopId']=this['loopState']?window['requestAnimationFrame'](this['iterate']):void 0x0;},j['prototype']['setupProcessor']=function(F){var P;return U(this,void 0x0,void 0x0,function(){var B;return T(this,function(Q){return B=this['resizeEnabled']&&(null===(P=this['resizeBuffer'])||void 0x0===P?void 0x0:P['size'])||this['video']['size'](),[0x2,this['processor']['init'](F,B,this['video']['ratio']())];});});},j['prototype']['setupVideo']=function(F){return U(this,void 0x0,void 0x0,function(){return T(this,function(P){switch(P['label']){case 0x0:return this['video']['reset'](),[0x4,this['video']['setup'](F)];case 0x1:return P['sent']()?(this['setupSize'](this['video']['size']()),[0x2,!0x0]):[0x2,!0x1];}});});},j['prototype']['setupSize']=function(F){var P,B;return U(this,void 0x0,void 0x0,function(){var Q,Z0,Z1,Z2,Z3;return T(this,function(Z4){return Q=F['width'],Z0=F['height'],this['videoRatio']=Q/Z0,Z1=Math['max'](Q,Z0),Z2=(null===(P=this['engineParams'])||void 0x0===P?void 0x0:P['max'])||this['processor']['optimalSize'],this['resizeEnabled']=!0x1,Z2<Z1&&(this['resizeEnabled']=!0x0,Z3=Z1/Z2,this['resizeBuffer']||(this['resizeBuffer']=new D('resize')),this['resizeBuffer']['setSize']({'width':Q/Z3,'height':Z0/Z3})),this['resizeEnabled']&&this['resizeBuffer']?(this['processCanvas']=this['resizeBuffer']['canvas'],this['processSize']=this['resizeBuffer']['size']):(this['processCanvas']=this['video']['buffer']['canvas'],this['processSize']=this['video']['size']()),!0x1!==(null===(B=this['engineParams'])||void 0x0===B?void 0x0:B['orig'])?(this['streamCanvas']=this['video']['buffer']['canvas'],this['streamSize']=this['video']['size']()):(this['streamCanvas']=this['processCanvas'],this['streamSize']=this['streamSize']),[0x2];});});},j['prototype']['resizeVideo']=function(F){var P=this;this['setupSize'](F),this['processor']['setupVideo'](this['processSize'],this['videoRatio']),this['renderers']['forEach'](function(B){return B['setupVideo'](P['streamSize'],P['videoRatio']);}),this['renderers']['forEach'](function(B){return B['setupCamera'](P['processor']['cameraRatio'],P['processor']['cameraAngle']);});},j;}(X),N=function(k){function j(){var F=null!==k&&k['apply'](this,arguments)||this;return F['iterate']=function(){return U(F,void 0x0,void 0x0,function(){var P,B,Q,Z0,Z1,Z2,Z3;return T(this,function(Z4){switch(Z4['label']){case 0x0:return B=(P=this)['video'],Q=P['streamCanvas'],Z0=P['processCanvas'],Q&&Z0?(Z2=this['result'])?[0x4,this['result']]:[0x3,0x2]:[0x2,this['enqueue']()];case 0x1:Z2=Z4['sent'](),Z4['label']=0x2;case 0x2:return void 0x0===(Z1=Z2)?[0x3,0x4]:[0x4,Promise['all'](this['renderers']['map'](function(Z5){return Z5['update'](Z1,Q);}))];case 0x3:Z4['sent'](),Z4['label']=0x4;case 0x4:return B['capture']()?(this['resizeEnabled']&&(null===(Z3=this['resizeBuffer'])||void 0x0===Z3||Z3['capture'](B['buffer']['canvas'])),this['result']=this['processor']['process'](Z0,B['captureTime']),this['enqueue'](),[0x2]):(delete this['result'],[0x2,this['enqueue']()]);}});});},F;}return A(j,k),j;}(M),W=function(k){function j(){var F=k['call'](this)||this;return F['params']={},F['videoSize']={'width':0x780,'height':0x438},F['videoRatio']=F['videoSize']['width']/F['videoSize']['height'],F['optimalSize']=0x400,F['cameraRatio']=F['videoRatio'],F['cameraAngle']=0x3c/0xb4*Math['PI'],F;}return A(j,k),j['prototype']['process']=function(F,P){return U(this,void 0x0,void 0x0,function(){return T(this,function(B){return[0x2];});});},j['prototype']['init']=function(F,P,B){return U(this,void 0x0,void 0x0,function(){return T(this,function(Q){return this['params']=F,!B&&P&&(B=(null==P?void 0x0:P['width'])/(null==P?void 0x0:P['height'])),this['setupVideo'](P||this['videoSize'],B||this['videoRatio']),this['emit']('init',!0x0),[0x2,!0x0];});});},j['prototype']['reset']=function(){this['emit']('reset');},j['prototype']['dispose']=function(){},j['prototype']['setupVideo']=function(F,P){P=P||F['width']/F['height'],this['videoSize']=C({},F),this['videoRatio']=P,this['cameraRatio']=P;},j;}(X),O=function(k){function j(F,P,B,Q,Z0){void 0x0===P&&(P='crop'),void 0x0===B&&(B=0x1),void 0x0===Q&&(Q=!0x1),void 0x0===Z0&&(Z0=0x1);var Z1=k['call'](this)||this;Z1['container']=F,Z1['mode']=P,Z1['layerCount']=B,Z1['mirror']=Q,Z1['aspectRatio']=Z0,Z1['layers']=[],Z1['setAspectRatio']=function(Z4){Z1['aspectRatio']=Z4,Z1['updateSizes'](Z1['container']['clientWidth']/Z1['container']['clientHeight']);},Z1['setMirror']=function(Z4){Z1['mirror']=Z4,Z1['layers']['forEach'](function(Z5){Z5['style']['transform']=Z4?'scaleX(-1)':'';});},Z1['updateSizes']=function(Z4){var Z5=0x1,Z6=0x1;Z4>Z1['aspectRatio']?'fit'===Z1['mode']?Z5=Z1['aspectRatio']/Z4:Z6=Z4/Z1['aspectRatio']:'fit'===Z1['mode']?Z6=Z4/Z1['aspectRatio']:Z5=Z1['aspectRatio']/Z4;for(var Z7=0x64*Z5+'%',Z8=0x64*Z6+'%',Z9=(0x1-Z5)/0x2*0x64+'%',ZZ=(0x1-Z6)/0x2*0x64+'%',ZJ=0x0,ZA=Z1['layers'];ZJ<ZA['length'];ZJ++){var ZC=ZA[ZJ];ZC['style']['width']=Z7,ZC['style']['height']=Z8,ZC['style']['left']=Z9,ZC['style']['top']=ZZ;}Z1['emit']('resize');},Z1['handleResize']=function(Z4){if(!(Z4['length']<0x1)){var Z5=Z4[0x0]['contentBoxSize'][0x0];Z1['updateSizes'](Z5['inlineSize']/Z5['blockSize']);}};for(var Z2=0x0;Z2<B;Z2++){var Z3=document['createElement']('canvas');Z3['id']='engeenee.canvas.layer'+Z2,Z3['style']['position']='absolute',Z3['style']['zIndex']=-0xa*(B-Z2)+'',Z1['mirror']&&(Z3['style']['transform']='scaleX(-1)'),Z1['container']['appendChild'](Z3),Z1['layers']['push'](Z3);}return Z1['setAspectRatio'](Z0),Z1['observer']=new ResizeObserver(Z1['handleResize']),Z1['observer']['observe'](Z1['container']),Z1['container']['style']['overflow']='hidden',Z1;}return A(j,k),j;}(X),E=function(k){function j(){var F=k['call'](this)||this;return F['loaded']=!0x1,F['videoSize']={'width':0x780,'height':0x438},F['videoRatio']=F['videoSize']['width']/F['videoSize']['height'],F['cameraRatio']=F['videoRatio'],F['cameraAngle']=0x3c/0xb4*Math['PI'],F;}return A(j,k),j['prototype']['load']=function(){return U(this,void 0x0,void 0x0,function(){return T(this,function(F){return this['loaded']||(this['loaded']=!0x0,this['emit']('load')),[0x2];});});},j['prototype']['unload']=function(){this['loaded']&&(this['loaded']=!0x1);},j['prototype']['update']=function(F,P){return U(this,void 0x0,void 0x0,function(){return T(this,function(B){return this['loaded']?(this['emit']('render'),[0x2]):[0x2];});});},j['prototype']['dispose']=function(){this['unload']();},j['prototype']['setupVideo']=function(F,P){this['videoSize']=C({},F),this['videoRatio']=P||F['width']/F['height'],this['emit']('resize',this['videoSize'],this['videoRatio']);},j['prototype']['setupCamera']=function(F,P){this['cameraRatio']=F,this['cameraAngle']=P;},j;}(X),G=function(k){function j(F){var P=k['call'](this)||this;return P['canvas']=new O(F['container'],F['mode'],F['layerCount'],F['mirror'],F['aspectRatio']),P;}return A(j,k),j['prototype']['setupVideo']=function(F,P){k['prototype']['setupVideo']['call'](this,F,P),this['canvas']['setAspectRatio'](this['videoRatio']);},j['prototype']['setMirror']=function(F){this['canvas']['setMirror'](F);},j;}(E),H=function(k){function j(F){var P=k['call'](this,F)||this;P['videoCtx']=null;var B=P['canvas']['layers'][0x0];return P['videoCtx']=B['getContext']('2d'),P;}return A(j,k),j['prototype']['update']=function(F,P){return U(this,void 0x0,void 0x0,function(){return T(this,function(B){return this['updateVideo'](P),[0x2,k['prototype']['update']['call'](this,F,P)];});});},j['prototype']['updateVideo']=function(F){var P=this['videoCtx'];if(P){var B=this['videoSize'],Q=B['width'],Z0=B['height'];P['clearRect'](0x0,0x0,Q,Z0),P['drawImage'](F,0x0,0x0);}},j['prototype']['setupVideo']=function(F,P){k['prototype']['setupVideo']['call'](this,F,P),this['canvas']['layers'][0x0]['width']=this['videoSize']['width'],this['canvas']['layers'][0x0]['height']=this['videoSize']['height'];},j;}(G),V=(function(){function k(){this['loaded']=!0x1;}return k['prototype']['load']=function(j){return U(this,void 0x0,void 0x0,function(){return T(this,function(F){return this['loaded']||!j||(this['scene']=j,this['loaded']=!0x0),[0x2];});});},k['prototype']['unload']=function(){this['loaded']&&(delete this['scene'],this['loaded']=!0x1);},k['prototype']['update']=function(j,F){return U(this,void 0x0,void 0x0,function(){return T(this,function(P){return this['loaded'],[0x2];});});},k['prototype']['dispose']=function(){this['unload']();},k;}()),L=function(k){function j(F){var P=k['call'](this,F)||this;return P['plugins']=[],P;}return A(j,k),j['prototype']['load']=function(){return U(this,void 0x0,void 0x0,function(){var F=this;return T(this,function(P){switch(P['label']){case 0x0:return this['loaded']?[0x2]:[0x4,Promise['all'](this['plugins']['map'](function(B){return B['load'](F['scene']);}))];case 0x1:return P['sent'](),[0x4,k['prototype']['load']['call'](this)];case 0x2:return P['sent'](),[0x2];}});});},j['prototype']['unload']=function(){this['plugins']['forEach'](function(F){return F['unload']();}),k['prototype']['unload']['call'](this);},j['prototype']['update']=function(F,P){return U(this,void 0x0,void 0x0,function(){var B=this;return T(this,function(Q){switch(Q['label']){case 0x0:return this['updateVideo'](P),[0x4,Promise['all'](this['plugins']['map'](function(Z0){return Z0 instanceof V?Z0['update'](F,P):Z0['update'](F,P,B['videoCtx']);}))];case 0x1:return Q['sent'](),this['updateScene'](),[0x2,G['prototype']['update']['call'](this,F,P)];}});});},j['prototype']['updateScene']=function(){},j['prototype']['dispose']=function(){this['plugins']['forEach'](function(F){return F['dispose']();}),this['plugins']=[],delete this['scene'],k['prototype']['dispose']['call'](this);},j['prototype']['addPlugin']=function(F){return U(this,void 0x0,void 0x0,function(){return T(this,function(P){switch(P['label']){case 0x0:return!this['loaded']||F['loaded']?[0x3,0x2]:[0x4,F['load'](this['scene'])];case 0x1:P['sent'](),P['label']=0x2;case 0x2:return this['plugins']['push'](F),[0x2];}});});},j['prototype']['removePlugin']=function(F){var P=this['plugins'],B=P['indexOf'](F);B<0x0||(P[B]['dispose'](),P['splice'](B,0x1));},j;}(H),x=(function(){function k(){this['loaded']=!0x1;}return k['prototype']['load']=function(){return U(this,void 0x0,void 0x0,function(){return T(this,function(j){return this['loaded']||(this['loaded']=!0x0),[0x2];});});},k['prototype']['unload']=function(){this['loaded']&&(this['loaded']=!0x1);},k['prototype']['update']=function(j,F,P){return U(this,void 0x0,void 0x0,function(){return T(this,function(B){return this['loaded'],[0x2];});});},k['prototype']['dispose']=function(){this['unload']();},k;}()),K=(function(){function k(j,F,P,B){void 0x0===F&&(F=!0x1),void 0x0===P&&(P='video'),this['renderer']=j,this['mirror']=F,this['sizeMode']=P,this['sizeMax']=B;}return k['prototype']['snapshot']=function(){return U(this,void 0x0,void 0x0,function(){var j=this;return T(this,function(F){return[0x2,new Promise(function(P){j['renderer']['once']('render',function(){var B=j['renderer'],Q=B['canvas']['layers'],Z0=B['canvas']['layers'][0x0],Z1=Z0['width'],Z2=Z0['height'];'max'===j['sizeMode']?(Z1=Math['max']['apply'](Math,Q['map'](function(Z6){return Z6['width'];})),Z2=Math['max']['apply'](Math,Q['map'](function(Z6){return Z6['height'];}))):'min'===j['sizeMode']&&(Z1=Math['min']['apply'](Math,Q['map'](function(Z6){return Z6['width'];})),Z2=Math['min']['apply'](Math,Q['map'](function(Z6){return Z6['height'];})));var Z3=document['createElement']('canvas');Z3['id']='engeenee.snapshot',Z3['hidden']=!0x0,Z3['width']=Z1,Z3['height']=Z2;var Z4=Z3['getContext']('2d',{'alpha':!0x0});if(Z4){j['mirror']&&(Z4['translate'](Z1,0x0),Z4['scale'](-0x1,0x1)),Q['forEach'](function(Z6){return Z4['drawImage'](Z6,0x0,0x0,Z1,Z2);});var Z5=Z4['getImageData'](0x0,0x0,Z1,Z2);Z3['remove'](),P(Z5);}});})];});});},k['prototype']['snapshotLayers']=function(){return U(this,void 0x0,void 0x0,function(){var j=this;return T(this,function(F){return[0x2,new Promise(function(P){j['renderer']['once']('render',function(){var B=document['createElement']('canvas');B['id']='engeenee.snapshot',B['hidden']=!0x0;var Q=B['getContext']('2d',{'alpha':!0x0});if(Q){var Z0=j['renderer']['canvas']['layers']['map'](function(Z1){var Z2=Z1['width'],Z3=Z1['height'];return B['width']=Z2,B['height']=Z3,Q['resetTransform'](),j['mirror']&&(Q['translate'](Z2,0x0),Q['scale'](-0x1,0x1)),Q['drawImage'](Z1,0x0,0x0),Q['getImageData'](0x0,0x0,Z2,Z3);});B['remove'](),P(Z0);}});})];});});},k;}()),R=(function(){function k(j,F,P,B,Q,Z0){void 0x0===F&&(F='video/webm'),void 0x0===P&&(P=!0x1),void 0x0===B&&(B='video');var Z1=this;this['renderer']=j,this['type']=F,this['mirror']=P,this['sizeMode']=B,this['sizeMax']=Q,this['bitRate']=Z0,this['context']=null,this['records']=[],this['frame']=function(){var Z2,Z3=Z1,Z4=Z3['renderer'],Z5=Z3['context'],Z6=Z3['stream'],Z7=Z1['canvas'],Z8=Z7['width'],Z9=Z7['height'];Z6&&Z5&&(Z4['canvas']['layers']['map'](function(ZZ){return Z5['drawImage'](ZZ,0x0,0x0,Z8,Z9);}),null===(Z2=Z6['getVideoTracks']()[0x0])||void 0x0===Z2||Z2['requestFrame']());},this['canvas']=document['createElement']('canvas'),this['canvas']['id']='engeenee.record',this['canvas']['hidden']=!0x0,this['context']=this['canvas']['getContext']('2d',{'alpha':!0x1});}return k['prototype']['start']=function(){var j=this,F=this,P=F['canvas'],B=F['context'],Q=F['renderer'];if(!P||!B)return!0x1;var Z0=Q['canvas']['layers'],Z1=Z0[0x0],Z2=Z1['width'],Z3=Z1['height'];'max'===this['sizeMode']?(Z2=Math['max']['apply'](Math,Z0['map'](function(Z6){return Z6['width'];})),Z3=Math['max']['apply'](Math,Z0['map'](function(Z6){return Z6['height'];}))):'min'===this['sizeMode']&&(Z2=Math['min']['apply'](Math,Z0['map'](function(Z6){return Z6['width'];})),Z3=Math['min']['apply'](Math,Z0['map'](function(Z6){return Z6['height'];})));var Z4=Math['max'](Z2,Z3);if(this['sizeMax']&&Z4>this['sizeMax']){var Z5=this['sizeMax']/Z4;Z2*=Z5,Z3*=Z5;}return P['width']=Z2,P['height']=Z3,B['resetTransform'](),this['mirror']&&(B['translate'](Z2,0x0),B['scale'](-0x1,0x1)),Q['on']('render',this['frame']),this['records']=[],this['stream']=P['captureStream'](0x0),this['recorder']=new MediaRecorder(this['stream'],{'mimeType':this['type'],'videoBitsPerSecond':this['bitRate']}),this['recorder']['ondataavailable']=function(Z6){return j['records']['push'](Z6['data']);},this['recorder']['start'](),!0x0;},k['prototype']['stop']=function(){return U(this,void 0x0,void 0x0,function(){var j,F=this;return T(this,function(P){return(j=this['recorder'])&&'recording'==j['state']?[0x2,new Promise(function(B){j['onstop']=function(){var Q;B(new Blob(F['records'],{'type':F['type']})),F['records']=[],null===(Q=F['stream'])||void 0x0===Q||Q['getVideoTracks']()['forEach'](function(Z0){return Z0['stop']();}),F['renderer']['removeListener']('render',F['frame']),delete F['stream'],delete F['recorder'];},j['stop']();})]:[0x2];});});},k['prototype']['dispose']=function(){this['canvas']['remove']();},k;}()),q=(function(){function k(j,F){void 0x0===F&&(F=!0x1);var P=this;this['renderer']=j,this['mirror']=F,this['context']=null,this['render']=function(){var B=P,Q=B['canvas'],Z0=B['context'];Q&&Z0&&P['renderer']['canvas']['layers']['map'](function(Z1){return Z0['drawImage'](Z1,0x0,0x0,Q['width'],Q['height']);});},this['canvas']=document['createElement']('canvas'),this['canvas']['id']='engeenee.record',this['canvas']['hidden']=!0x0,this['mirror']&&(this['canvas']['style']['transform']='scaleX(-1)'),this['context']=this['canvas']['getContext']('2d',{'alpha':!0x1});}return k['prototype']['start']=function(){var j=this['canvas'],F=this['context'];if(!j||!F)return!0x1;var P=this['renderer']['canvas']['layers'][0x0],B=P['width'],Q=P['height'];return j['width']=B,j['height']=Q,this['renderer']['on']('render',this['render']),this['stream']=j['captureStream'](),!0x0;},k['prototype']['pause']=function(){this['renderer']['removeListener']('render',this['render']);},k['prototype']['mediaStream']=function(){return this['stream'];},k;}());export{N as AsyncEngine,G as CanvasRenderer,M as Engine,X as EventEmitterT,D as ImageBuffer,W as Processor,R as Recorder,E as Renderer,O as ResponsiveCanvas,V as ScenePlugin,L as SceneRenderer,K as Snapshoter,q as Streamer,Y as VideoCapture,x as VideoPlugin,H as VideoRenderer,I as VideoSource};
